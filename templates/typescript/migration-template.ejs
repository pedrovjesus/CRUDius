<%# path: database/migrations %>
import type { Knex } from "knex";
import { ETableNames } from "../ETableNames";

export async function up(knex: Knex) {
  return await knex.schema.createTable(ETableNames.<%= entity.name.toLowerCase() %>, (table) => {

    table.bigIncrements("id").primary().index();

    <% properties.forEach(prop => { %>
      <% if (prop.field !== "id") { %>
        <% if (prop.type === "string") { %>
          table.string("<%= prop.field %>", 255)
            .checkLength("<=", 255)
            .index()
            <%= prop.isOptional ? "" : ".notNullable()" %>;
        <% } else if (prop.type === "number") { %>
          table.integer("<%= prop.field %>")
            .index()
            <%= prop.isOptional ? "" : ".notNullable()" %>;
        <% } else if (prop.type === "boolean") { %>
          table.boolean("<%= prop.field %>")
            <%= prop.isOptional ? "" : ".notNullable()" %>;
        <% } else { %>
          table.string("<%= prop.field %>").index();
        <% } %>
      <% } %>
    <% }) %>

    table.comment("Tabela gerada automaticamente para a entidade <%= entity.name %>.");
  });

  console.log(`# ✅ Created table ${ETableNames.<%= entity.name.toLowerCase() %>}`);
}

export async function down(knex: Knex) {
  return await knex.schema.dropTable(ETableNames.<%= entity.name.toLowerCase() %>);

  console.log(`# ⛔ Droped table ${ETableNames.<%= entity.name.toLowerCase() %>}`);
}
